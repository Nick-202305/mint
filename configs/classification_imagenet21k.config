multi_modal_model {
  vap_model {
    modality: {
      feature_name: "visual"
      # Sequence length = dataset.input_length_sec * dataset.sample_rate
      sequence_length: 50
      model: {
        patch_embedding: {
          image_height: 224
          image_width: 224
          patch_size: 32
          stride: 32
          hidden_size: 768
          depth: 1
          model: MLP
          weight_decay: 0.03
        }
      }
      model: {
        transformer: {
          add_spatial_attention: false
          max_position_embeddings: 1000
          add_cls_token: true
          weight_decay: 0.03
          intermediate_size: 2048
          num_hidden_layers: 8
        }
      }
    }
    task: GENRE_CLASSIFICATION
    target_num_categories: 21843
  }
}

train_dataset {
  name: "train"
  input_length_sec: 1.0
  modality: {
    general_modality: {
      feature_name: "visual"
      dimension: 150528
      sample_rate: 1
      resize: 448
      crop_size: 224
    }
  }
  data_files: "/readahead/1G/cns/jn-d/home/couchpotato/tf-mint/datasets/imagenet21k/train_tfe*"
  sample_window: false
  data_target_field: "labels"
  target_num_categories: 21843
  data_augmentation_options {
    image_preprocessor: {
    }
  }
}

train_config: {
  batch_size: 512
  learning_rate: {
    manual_step_learning_rate {
      initial_learning_rate: 1e-3
      schedule {
        step: 20000
        learning_rate: 1e-5
      }
      schedule {
        step: 80000
        learning_rate: 5e-5
      }
      schedule {
        step: 100000
        learning_rate: 1e-6
      }
    }
  }
}

eval_dataset {
  name: "val"
  input_length_sec: 1.0
  modality: {
    general_modality: {
      feature_name: "visual"
      dimension: 150528
      sample_rate: 1
      resize: 448
      crop_size: 224
    }
  }
  data_files: "/readahead/1G/cns/jn-d/home/couchpotato/tf-mint/datasets/imagenet21k/test_tfe*"
  sample_window: false
  data_target_field: "labels"
  target_num_categories: 21843
  data_augmentation_options {
    image_preprocessor: {
    }
  }
}

eval_config: {
  batch_size: 512
}
